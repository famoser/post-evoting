/*
 * (c) Copyright 2021 Swiss Post Ltd.
 */
package ch.post.it.evoting.votingserver.commons.beans.keystore;

import static org.junit.Assert.assertEquals;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.security.KeyStore.PasswordProtection;
import java.security.PrivateKey;
import java.util.Base64;
import java.util.List;

import org.junit.BeforeClass;
import org.junit.Test;

import ch.post.it.evoting.cryptolib.api.exceptions.GeneralCryptoLibException;
import ch.post.it.evoting.cryptolib.api.extendedkeystore.KeyStoreService;
import ch.post.it.evoting.cryptolib.asymmetric.service.AsymmetricService;
import ch.post.it.evoting.cryptolib.extendedkeystore.cryptoapi.CryptoAPIExtendedKeyStore;
import ch.post.it.evoting.cryptolib.extendedkeystore.service.ExtendedKeyStoreService;
import ch.post.it.evoting.votingserver.commons.beans.utils.PasswordEncrypter;

/**
 * This IT tests that keystores and encrypted keystores passwords that are generated during configuration generation phase can be recovered using the
 * appropriate private key, that is held by appropriate services.
 * <p>
 * During the generation of the configuration, several keystores are generated. These keystores are used to protect private keys. To open a keystore a
 * password is required. The passwords for four of these keystores are encrypted using public keys (at the moment that the keystores are created, and
 * the password are never stored in cleartext). The services where those keystores are sent will possess the corresponding private key (need to
 * decrypt the password). Therefore, when the services need to access the private key (contained in one of the keystores) then they must first decrypt
 * the password of the keystore, and then extract the private key. This IT performs these steps.
 */
public class ElectionKeystoresITest {

	private static KeyStoreService extendedKeyStoreService;

	private static PasswordEncrypter passwordEncrypter;

	///////////////////////////////////////////////////////////
	//
	// Ballot box signer
	//
	///////////////////////////////////////////////////////////

	String ballotBoxSignerKeystore = "eyJzYWx0IjoiaVQ3Q0lXTFo2b2VKOFpuSmRRUGtMMjl2Yy84QkZrS0lBNE1tQW9wRDRkTT0iLCJzdG9yZSI6Ik1JSVR1QUlCQXpDQ0UzSUdDU3FHU0liM0RRRUhBYUNDRTJNRWdoTmZNSUlUV3pDQ0JYQUdDU3FHU0liM0RRRUhBYUNDQldFRWdnVmRNSUlGV1RDQ0JWVUdDeXFHU0liM0RRRU1DZ0VDb0lJRStqQ0NCUFl3S0FZS0tvWklodmNOQVF3QkF6QWFCQlErUFV6aXFpVDlEOU9RbVN1d2lnSVo2bFg3OWdJQ0JBQUVnZ1RJVVRnVWlJYlB2cHlodHB5ckJ6RnFQK2xNd2ZlejNGdmh4OVByYkJaVDhJd01ZTkxucUJSckxKanZ2ekt3NzdKV2ovU0FIeTB0UlFDRDR4RmYwQzlQK3VvTmNJeVdVWFlPQ3hUUG5NVU1CM3ZOR0NCcFN6TEdTd1A1MWhmSjQ2M0wrbFJvNWFFRE85LzgzbTVNSkJOMnNtbGZvdVRrK2d2TTJEMSt1ZDBuT1BSWHQ0Z3lYdzdQaEc2TVhGOXREMkxNVkNtM2tJVFo3bCtBUTFHa2RvOHNVYjEySHV0bk81OG41WjBpT0hBU2x6dHdXaWg0WGt4S0xHRHZoaXY5REVUZ1AwNEgzNXYyOEtiRjR5ckpjQTgxWVkrSUZMOEg5VGRYM2tXRytEMnpXeU9WcElxODZ6M2drTEM4c2ZZRHNlZHFuKzM4SU9WZjJETnJ0eXgyQkxMdkRYcjNHNVAvd3B2QWZLaGVSeGluZXJPM0F6Z0pRQkdjOWZBZEZ6UkdOaEV5RWZBRDZla0tDZm4vTlU5NkFvYUhpalI1TC9relBFYjVkTzlYYlo4ME1YdXpaR1BiWEhrWkxib0VNZHV6UGJsbys0RmgyY0hrNGgrc2o4YU1QZjdIWEl5Q0oxaEZCUENTcmRvNit5RUhZT2JBWmQ5dlkxaGxyRWVuNkF4djkwdnpJaFNWYnQ4S2NZakhaZWZQV3BlOGEyM0poTE5Idkl2eFJqcEljMzNEeHZ2cUFKQVlvZkJ0c0xuY3Q3Q0d2TzBjdURNOWFqVExncHFQTkxTdVovRUxPaDdHYlczN21WejhjQ0FqK3lCYUs1L0UwaEFxdEZaNWRycEpYVXk2enRyMWxYK2FON0tjblBYZithVW5CUnFuRVdDU0g2K0xDWElGR1JGb1JZODdVeFM4V1VmazJLa1ByazZOakhFMWJhblJEUmZLMnFqc2hyc2ZJRVAzclQ2VVloSXNNYkFzc2xneTV6OWZkeVNjMVc3eFpmMXdRWHlnTzUxb2ovREF4KzdUeGZINWhyL3VtZkllaGNwV1AwVFNBMUJjd3dNbC8xM0taSHBxaHNmbVYrbTNxRjE1ODFlVWRoVjg2UGtTZzJWaVNJVXNpcXpscHR0YS9reFRIQVBRVGs1K2hSU3l3SXNpdm4xak84Wjg3WlYwZlZRcDdlaFFvYUdxMnp3bDFvYW1CQlN0SzJSNlFlTUVOalhRbmpLRmR5cEh1WDhIOFZOODhEeTFCZWk3c3hkSGdwbW5rcm1EMC85bDB3ZEJVTk94OTRWSC8rUHBXdmJyWHpZYTBFc2xTTEJuUzJCWEJWTFh2YWFmbkRYZnk4MnJrTldMWXRRa25LRW8zY2hlWkhzVVd3aWpPODh6Snd3bmFHUXFpcUZJS3Z2eENEOHJZaUlBMVY1RWNaVFliMUF4elU5bjNjdVV3UVF0Wmd5MzdNVGRaUkFVWWg2N1FKenltaGUyb0RrSmlQNmFTbERaaXFqMWs4bnRJdHR2WmFnQlFpUEJqcVI4OElYWmVaZUcyL0pzS0g4aTYwa2w3emFGeHhIOUtvdHFob3dKMWh4VmxvMHBCYTRWakpnTUk2RjU1NzE4aGJISWxySllOZVFldVFkQVZQaVpBcGNaTHZKNUdVM2hLYzJDS1owUFcweFFuUzA4S0JBMm1JbmQ0SVhHV2FLaStrdUFGd3BsSjdEbWNWZ0NHR2ZHd1ZTQVRlSlMrME45RHVlY1ZsRE0yWkxLZ2o0Z04xYStoaUtaZEVML28yMVZva1l0bjAwcFVXWENLTHhQUU9pcDVIbFJNMEZCaWNkVi9jOGx4YjhKdFdHSW9IeXBaZmd1amZVQ3liS2pCdjFqYTNUWmJCREdWVURqdjZ6RUI0ZEx6Nm81dXRZZitJd05lMUZhb0pvZkpyRDNBR1Q5SUljNklyV1o1aVFES3Fqb3NqMHBnTFdNM3lZK2ppZUpLWFRFS2RUNkNRTlNQcDJlMmpYRWtkYUNYRHZFcjljb0didFZrbjhEeU9yUmRqSmJaU3l0dUkwd3A5N3dxcWphUWtzVWgvU2lERk9XSjRoTFJhRUM0YmlJZjJ3VTRuWEJTOG1XRGt5OU9CK0Vpc1ZkZmZ6NmIwanRHQ2FVcDFVdmdSdWNic0hYaVZreWJmV3NoUHBVVmdQTnU5d0J5azhvTVVnd0l3WUpLb1pJaHZjTkFRa1VNUlllRkFCd0FISUFhUUIyQUdFQWRBQmxBR3NBWlFCNU1DRUdDU3FHU0liM0RRRUpGVEVVQkJKVWFXMWxJREUwT1RjME5UTTNPVGs0T1RRd2dnM2pCZ2txaGtpRzl3MEJCd2FnZ2czVU1JSU4wQUlCQURDQ0Rja0dDU3FHU0liM0RRRUhBVEFvQmdvcWhraUc5dzBCREFFR01Cb0VGRjEvMUd1UXNXaHNWRTR5SVF5YWJpZnZ2YTR5QWdJRUFJQ0NEWkNkQkVUcDRob0V0MS9iU1UwZVZOUVozUW1nOWg3WjZpeHo3OXRyNjE5YWJyU2JNSUVSZDBPdzc1SWhzVEVReEVjdjVkWC9YeVFMWDdOVkxUQitzM0h6Y0lhcGUySU0zeTh0QmxveUYzRVU0dGk5d1VVQjNRanB6bytjK0ZncnpadzlvNGZpcnhGMm55Y1ZISk40enpweU0rcDArdWl3RlM5SFdOdnlSVzNvOTVuSUYrM3NBRkJxL1pTdzY4c1dpbEhqbGZJMU1KTGt2WEgrR1N1WVdCWllqZGladTZtcHlGNWZvakRUaktPaEw1SllFeGl2Q3pNamtHSnF1b0pBdWtkQXdKSHVaVkFjek5vTURpN0k0K21NbTFaNkhySG96RGoxRzI3N2lMV0sraXF1cE9GdDR6QVZtUFFodDQ1YW4rNmtQZ0VxZCtQUThRYXVxcWExak5uMHBHTDdLdHVzczlGUVNCd1ZKSUNqbGVRWUl0WVliamJNSlVYS2RVcVRnYTNqTmcrOXkybEVrZ0pWTm5veUcxOW96L3RiejU2dDk4VDkvZk5NZzIrNVIwQnp6OTV1MWdvT3B0dDlKZ2IweExiSnU1UjM4M1oxWEhXcjFtb3pBbEhPWmROa1pxS0VYYW5WS1BQdWNmYTVGbEVLOUNwUXMwcXZnSndUekxEdzF2c0d2L1hKOStFK29aYVNOWkJUVnFPdTFJaFJKV1FTclBJVWMvL2Zna0dzRFpFY0IrMTMyM3hGemhTVnhOVWg4azM5RDFQdHYwN1FNbTVqQ0Y4S0c5b1FhWnpTTFhVUHFseU9iVUY4cHkzei9YQ25ZOUkzcjlmandEdlMzSDRoRWRsbWFzZitLWDBkNmpPM1BnclNkWHZ5b3VMbnFBR1VneUhoVTlPMVhyTHZpVUdHcm5KeXQvUnZhVGxLT1N3RmJCMkRLb2ttY2UzSEZ4K1JWK2JFUktaMTFTb3dUc1ljZ08vUDBBeUhtOUZUSHUrTm1XbldsUkpCWVdKTTJEU1U0c0V0SjNsMFI3U2Y1Yk90Tm1vU3hHenplUjNCQWNKcnp2d0IvV3ZVZnB2cFMzUDMyME50WjRFZlh6MjRtT3Vxd3NtMDA3UFhDbjMzazV0Mm1KQU9JUVJpbkU1YTB4OVNEdTVSVVZicllDdHI4eDJDdVZmYSs0MEw2QkR5dXg1V1JjaGd6ZGMwcGRyZ25MTnVYamtzNjJZaTBucHBsS29TOFRnalhkcnN1eG5oM24vbFJkN1FhN2JyNlhOaEt0WmozUmRwL2ZtNkhXaEZRU2w3NUtDcWl2cVlaSzhFMmtibmp1OHFmZkZkRFZtS29qR0IvVmxQVXFoMFZoTGVaYnRXYmtkR1MrQXI0WDJCb0ZFY3lvNkVFUEZuZlc2YkEvOU53N202R2loSC9mOHNQcnBWVGpDZGdEeWs1Zi9KaTdsWkZvTkRScTJOc2VVd3pBRHdoNjFqSE9pSGovOHl0UkV2ZGVCTEE2eHdmTWNCOGtUMGlDdS8wVjdPKzZFUzR3Sm1oR2RZeFZuSVorY1BKSnMwanZqQ0RIdVpsbUJvNEptaUxuWDdjVWx1UCtJNDlrYjNNbVlwbyt5Q00wUkpCMkRLd01QWllCWHdZaXJ3R2RoSmZSSW4xZVBlLzVKM1lRVFZLR0dST2dDdGJ6WGltcEsyYXNsUVQzZ3A3bTJVUWRia2Y3dHpXN21wdHBScjFoenlKbjFVdnpvZ2duZzRlZnJITmxUbGpJc3dQcis0dVNtdWVyd1U0UDJqejdFN1RMRlhFTTNLQ01CN1hzckp4N2FRb28wbnFWc1kyNVN1cUNlVkdtYUxlLzNBNFloRm5wdDQ2d2M1UFFtbmZKaFI3MkFzTWRqVTdSYXFaUTB4czFNL05OZ3FFR3ZIbnQ1Uys0ODBOVnNZZE1qT3d6dTMvQW5RUlN3c0c1ZEVlQ1YzdXQvY0FlZmg4SlJUQVVSWC91Y3lJSEt2QWNhZnF5cjdQcGtnUXA3Zncyam9lQ2E3clNxZVNKZ2FPQ1ZINXVkM2FEbSswbGJhQUQvT2hCZFB5NE9TOEgwMS81T2NENWZPUkhWOEhZRUFvTlk5Sk1ydS9iS0NGeFQvV2R1c0hjWGFvRHFUelVGbk10bU9zU2dKRmRXRVpMcUZzMjJ3anVUWW5nVHl5TU9XcFptVWdEVzlJTnpWUEFYMldKanJOQ0NXQ0pydU0rQ1UyZXEvSHlkTTB4cHRFZXhCM2dmMjUxS0lta01RaFgwY2YvRUloQUdvTFNRblJkZXJGc2k5aUc3OHhzY0xBOGxTeU42RUU1SDRXWm9qWWtlWTBmVWNTMFplRFBuQlNDME1iVGF0SXkwY2lycmduQmJLVlo0L1Vud0wyTG5BUUR0YUVJVENKdVY4M1J2RUpqSDBjN2JGS3Y2MjVvUGlxczlHZThyK3hWSzIrNklMMnRjcTVsOHdTY1g3cWVHSVAwKzJFZnhvQW80VVh5UGg2cGsvRkxLVjU4amk3WDMvVm1oWGlGL1BobFNMakFoREhudTI1WWtkUld1dk1pa2p1NTlqZGhtcmxRNVJiMnFsaU80S1VHTU9ncS9HN3l0NHV6emduSkJtSGdFdGZzQmw3S2tzUWswcWlXMnkxeFNCRTBsNk05ck1maDhCZVdqcGR0NTFDTU95bmFpMlkwMXVNMlBBTVpURnFIR0VnbDY2cDhYdHRUbEg3OEY0UURWaFVLRTV4NnJuWlJ3dFNJTFZONHppTWpzOEFJZnYwYkhNaitxUEhnZ0Zybm9qaUVYajBiOGNMVWp2Tzd3RDVXOEZUZkhTQTZnMkVwOUNXZmFDTFhqWWdoQXhMNndDT2ZMUHN4bThQek90ck5Eb3RXdjRWNUQ1QXpSRHdJaFpYZUtSL0Z4K2M5WmFYWFQzWk1OR1Z6UTJORis5eW1reHYzMFAvTk1pUUJ5YVZXaWNpVWxwTC81a3ZoM2hRem9JTDZ4TDBGcVdsdGwyWjJRN2dyY3VEUHJKR2RSbXdLS1lZUkVjdHJkWHNCS215Y2NIQk5ZMlJ1V2MvSG0zWkl4UTlIUXRyZXVCaWx6bUdHUldLU1ZJdndHUjhPNmE0UjhVQzdXdDRtdHVrN3ZndU1YUi85aEluenpaZHFWR0hTMGRwS0tKOTQ5MTBhbnByYXZaK0NxZ3BsZjY0TXhXblUxM1RSZllIcDZqOFc0R3krczhZT1F2eDRTRTdOa3ZJT01INzF4Mm85aUxqdlg5eTFzNzlQVlFDYnpreTBiLzA3SG9XVzZwMG5veE9vV29QMGxGalg2S0pFRzZXU2xlVk9WQlVNclExSXp0aFFFdVVRVkVJQ05QUERUd0RjUk1BcDRYcGs0eHJ2WTc2VzNsMnpPMVN6c2NiZWtEOXUzZzRKOGQzc1p0d2JnNVZ1THpQNFRodXh6WFlQMUtMOHZLQXZUbDRSQjQ0UW8vVW93UXB1YnJrN0FvMCs0WUNqNmtkd2JuQjZsVVdCbHR5V0M5OExJMFB3UFNpcmdSZXhBYWFYaHVjeElzRGo5dXlyVDNFM24reUQzbnBBR2dBSEE4QnNTQ1JsVXFuNU5lUWsvZ05CMTV0RTdRcjNvOFlLK1J5aTJrbnIxeDUrZmZnVzdQTk00TkRkZFRJRVJpMkVVRVMya0lJckNDejROSU1uUDAwOFNlUmFEZkFyVFc2V1M1eEVleXVoaFMwdkxxTkR4L1NPUmNZWXI3QkV5b3dxWDczWEY0TVVHNHhOODd0eEd6bmx5cUVQeTg1Tnk2Q1Z3UUFMc3hhcjhXeG4zZklVT3J1VFNqN3ovejRXQXE5ZU9hRVhTd3NGUEVzU2wvQmd4TU1CbS9VWmZ1SVVzR0RlOUFPWDM4MFZqWDloaEJmTXovcVdNUkE3ekhXZVFlL2JoVHZXeG44UVlwc3AxUzZMOTd4OWVkNGZOamNUcFg5VkR5TkpvODFyb2QxQ2dYeDg4bzM3ZGRDaEdOMWFuMVYrVnpxQTgvZzltanpwM2dmVytLMlJSWU84UWNCL2E4TEdBVGFhZmNuNWRESmFjeTNVUG9GcENLTlo3MzVWWFdoODhvTzFsbHRScm5CRFJ4b0cxR29OcU1KU2E2VFBwVWFnM0g0ekoxdG1UenFqbko0ekUyQytESGxBMDRWYTZDNm9SbHdFbDdTeTNVTTN2cnRWcW1XRzl4R0VsVjBNSXhxR3NzY1FYa3huRmF3SDJVb0ZuSHRBR0xINlo5Z3RoOEExMW5uZW9leWJ2SW1yYU5EWVVIRTZtaTdGdmE3RDZIN0VPS0lIbGNpd1ZGSGs3U0VXUVd5WDhkblZsK0JueS92eVZZdVZlSUdPMGZDY0UxSS9JRHd4VVpUYk0waXRxNkFiVWtpTEZNOGRTazJmQy9CSk5HM2JTVEI2WjhhbVdzVjVaUThjdnZDOE50OVduNTlNTTNvMEticEE0c1gzN24zVEhLNzl0Vkt4N2xNRzRxcWwxWTBjYmhFSFlSU2pGZ1cvOHJNUXR3cWx2bXBSU29aU3FlR1J4YWo2WEJRVkJFZ2pDeHRzSlc5V2NnUkFWdGxBZ0xSL2pPRVdMTmx6ME1yenhVTDZXNEo1Um1wM0M0MFA5aHJoVjdtbFREdVRDTDdZN1dGZ3BqVFBhcVlicmprQlQ4UFpraE9rVk0rRXk3WFQxdWlMQStvR0dUbUliRCtUZm1yYkJpSlVkVFpldXl2eUJhMkp3TytxN3dSdUppS3N6RTl3bFJFZFpha2lXSGVOY0xtMkNxck9SWjViRHdLSHBCRGYvdk9IY2ZEZStnS3hsVG5JaTNBKzFWYmZXWnQ4SFliY2xkYjVlWGEzTFV3OEE2eFVVWDlkVyt4RExqREl1cmFKbm5iVFh2a1NmUDVyT2pESGNsTWYvbGRsVHp4c0pHSTEwTVdZUzJHeXhHSzlhNm55eTlPMnBPSGZsOEtuYm1tVVdUaXlIT25UK2o5bERCODBjYzRlTlpMNnIzTDdLSWpLSDdBVXJPNUltb3NxZzQxSUdXNzRZN1o4ZVRTa2lDYnc5WUd4WFRab2FEK0oxTEtnbWN0eHduNGdTZ010eFRqZjRUdERMME5UMGRWcmNJamh2eENuaWZvOVMwR2V4YnJ4aThXWFJNNnc2UXV6ZnZYcGpWaTRnUzZDZXRIQUtlejg5ekdiYklRZkpmazg3RlZmWVpDNzlPUUhZdnJDeVQvRTAzaWg5V0VmdmFFbEswVW9WNXN6SWxDNzlYQnJCdUN0SDNxeG5Fd3p4NUoybHdOeWhRMXhLQXM3OFpBUFF5Rityak1VeWNwTWxtY0ozQTJNekRBbXYyNUk3cENYSmVvc3E5UTB1ZzZyVjBlWEtOck9zdVZiQmh4ZEVwanhaeGlyTjJJZ0JnWGFBZWo1STFjZUtCcUtoL3ZUK29TbVF0b2RKSjBXTWtneEF4dDE0UXlBZFFYSmlYK0tzUjhsZEs3b0kxU0Npd0FXQ1QwMkx6R216aS9DNlF0emhIeS8wQitVZklhU2UzNTJVaUhIaXNiQ2c5c282V3hrcDhONHhFN2tLSGRzZjJsdWJ4dWtCWEdkUGRBS0lMbE5EL01rQTYySUp3MFJDVGNiQksxMFptd0F3SjNtc0N1akxBb01wMVZTVUt0WS9jTzQ5c2dxc2RrQW9TZGc1UkNBSzN6eVJsa0c2bE5hRk9ja1JXTnpxTzFBc1JGNkZGTHFqWGsvd2FKNzNOSHdjc3UrbUxOcU9QZGhVYzdyOHV1elFLQzZ4K0lwTVVleWdTY1lRRUs4N2tsckxqbTlJeEIrNFNPRjU0YUdNWEVaMVNTbU1rajNIcENOMmVEc0pld1JNNis0TmFUQ2hRaEFFZEZ5NVVDTnJveS8vV25pQ2Z5ZnNLaU1GLzJ4UFovYmROcS9nTmdqR2JMajlUTndpMmprTkQvYjQ1WGY0ZEZhVEhjQ2poUXVuV2JrSXdTNDNhODVsVkpFa0tVZlRSclBFODlMZkdRU3ZGcEIrZDlTS0xqcHdCeEdwS0hoMVVJVWsvL2dUV2w1ZXc2WDZacGp0RHBzUHI1NW9rclV6TmpLbHhqYlpnQk81OVZxcHNBTS9WcFFDU0lZVm5kVDVFVSt4UEVNaEFmR1E1RVI1QzZRTzkyUXlsTVBiWCs3dmowa1Y1N1JZb1hJYlhNRDB3SVRBSkJnVXJEZ01DR2dVQUJCVCs4YXVUYzJic0hUMTRiM0FRUituYnBLSVk3d1FVeXBXNUVPTHVsMnR0WkZUdnpSYS92bWE1YmNFQ0FnUUEifQ==";

	String ballotBoxSignerKeystorePasswordEncrypted = "XuL3LKUWsaCPqUgMhtNkuEEDqxxL1gHbQgadBW5G1OyDMyIE5rINEn4Xz45XnStMDRNrPe0L41PjUZ1SWLbavuD41ogYsKMSxMvPWiPIzj+oZQQ2pjlmm+Vb/xeUrIuKVi4PG1eCMKff46JFZMEMqWOlr2WOpMccHjhCOMGXQIEGcTUkPnlJfOflJHPMEoLuscDyNgJmG0zNS6sKkKDrLM7JAKMtIGXjLBN5lsD3FFRpQTPsvDl5Q4SU7Fb810y1WNKVTLP+dooCzvC7FIf87ryGQUMEXxaYVsX0uLI38n4KgT8RknFY9XRyz6eMR2PWrZHKLwt88ZldkAy+v+Qws3FwoIsUtiQv8ODm9VB0oiILiY3kVMUxmPZCLwsQB72Pe3WLWPDL733At+pyeBMGt3GQspbZzg==";

	String systemTenantElectionInformationKeystore = "/keystore/100_EI.sks";

	String systemTenantElectionInformationKeystorePassword = "VJTFGCIEYGS2MR4IOAXPB2PMZ7";

	///////////////////////////////////////////////////////////
	//
	// Authentication token signer
	//
	///////////////////////////////////////////////////////////

	String authenticationTokenSignerKeystore = "eyJzYWx0IjoiTy9CVU5LQ01LZS9uYWhTU1p1NWJ2MWR4YUxmNExXU2JHTXMwNkNiWU00TT0iLCJzdG9yZSI6Ik1JSVR3QUlCQXpDQ0Uzb0dDU3FHU0liM0RRRUhBYUNDRTJzRWdoTm5NSUlUWXpDQ0JYQUdDU3FHU0liM0RRRUhBYUNDQldFRWdnVmRNSUlGV1RDQ0JWVUdDeXFHU0liM0RRRU1DZ0VDb0lJRStqQ0NCUFl3S0FZS0tvWklodmNOQVF3QkF6QWFCQlI5UFJyMlNrbmdzaGpyNjg5MW9tejNHUUlzWGdJQ0JBQUVnZ1RJR21YOEY2R3dqOFdPVUk0M0dIRVo1S21uS0hxS3grRHFJbmMva1M4elo0TE5LYjM1dVU3cjFGa3ZEeFlTK3FRdHpTZ1IvMzhEZVJjY09PVWtSR1p6ZmNxa05NQXVJWFVIMllWWEFGYk43NmFrVkRWVlh0VmkwYVVlZFJLbkF2SFF3bm44S21PTnJacHRsUGlGcjAyVXdOUXJmMWhkeHNTSG4wR0ZoVW12N3Vsc0xEWlNBNGxzNCswVDNGRzg0MDBpNmFmcDNvaE5NNXhQa3ZzZ3JoL3ZkaFpiU3NvTVB4M1MxSEp0clFEMTczbUpEV2wrMUJqbTBVanpGcWU1ZjVVUWJBcUpETm9pdnV6R3hxd2k3SkF4NmFCYmhPeml2aUdaenFYejR4YW5zdUVBSFA1ZGJPRDFId3hXZUJFTmdEVVMwZzNTdnMxaDJ6RDVGdzF1OUkrMHY2dE96ZUZqSm5KdzZDNW5mdXhNWTJ2QWxmWSs3RHFyUlRmR25mZ1NmYTdrb09lUGhtUWxDcFd2NU1PM3B4UldhZjM5RmllSWRtbzIvbDhXejhFeC9TbElUUEFQemdqb1N2YUEyb3piczBGYjhTM3ljOStUTENoOUVERm5zVFUzWWp0SnF6ZituTEREQ1gxb0V5N3l2enZicU1WNzBtYm9qa0RrQ2lVRTZjcEk5cU5XK1prdjV1N2hWUXZsZGUxcXIvQnVFQXhUQjFqUm41NUhpTGVqbERwb25Jdk9DSkt2Rit5aUQ2NU85a29MaVVCalV5azNvdjlOcFNVZGtOWU54UDM3RUxSY2VRWHVxeGJJZm9HNmtpbWZrcEVnV0ROb3ViVE9mUDg0WGd5bTVHVmljNW40RG9Cank4Wk1OemZyNXd5OGpKN1p2N1ROSmZpN1QwV3hPbXlkdk04OU5yMWZrUTZINGRPYU92U1JFeFQxKzJId3hjUUNDb2ZiVHN3NEFVRjNTa1VZL256cmdGNWtnSlRoUVJRVUd1NDdMeFBwUVpGWENpckRCcUNKeFk3aU1qTzQ1OU1velQwVG1TQStveFNhYzZWQlNQeTdFRWtES2hWWXgwYWw0VzFUWFp5NW5YczgvSFQ5MVYzU1VzVDFOaEZxVFRxbGdoV1JHNWJDM2NRWUdaVjJSYk91YUdGc2JWaC9qL1M2SnhLQ0tMZ3RpUytmZm5XOTdrdUpuRmV4dFV1QjhnQWI4OEphNk1jUjI2TmVpVGtEV01GRWt1c1BTWHI2Q0swaitDNE41ckU4SDR2ZGFuTjFNZjl5ejZxL0JBNVFsQW1VVks1UTZVNE96YlhTWWVBR1lCaTEvVFFIMGgvUENRZDBkQU1UUHlQVXB2cWZCazhFb3ZQUGFQV3JzUzJwWkhEWm56OURxemR4bGl6cUt6elFVZUhVcC9QY3ptbHBucFluRkx5bGVjRXE0NjdoQmZ0Nk5XYS9xVkNhbEhvZDZjVlJFd0t4OGNXdnFCZXI1L3JzbWFQSXR3YmpYU00wRmJJZXJjYS9yVW5uSDVnbnZ3d0ZMYnFTVjh6S3FDZUxFSjdRd0xPdWR1TVNXa2c5di9KWjk2TEdqZ1VjZlU5VCtZQVZZSFFyU3FPbTBtdmtjRDI2WE5iK0tVaHJtV2VKcUQ1ZDdIWXh5SWE2WHdRMWRwUC8vOHU4bFkrSk16Rk9qYUlWNzhMUE9qZjlleEhKWStVV2xVcEhEd2xhRkdRRUlvOS81bHNrWXlXSmdOMGRPUG9wN0M4TGxwSUcxem5ESmtVUmwvTEY5T1BHb1cxaEhIcDBjc1FtcUFNTVN6N2syNzgzMVlpOHJaSjZqRlUzNlNMaGVjZU40dTc5UGJwWkhBdDdFRm9IVWRZVmIveU9mZkI1cjdDdFl0UUlXelhqUm5oMnRZK0xCUE1uTDNHem5wRkdMQ0owVUFkZVA5Tm84NDI0aEYyMmNmcFlBMndlQ0g0RzhyVmpMMEZXbXlzdGVuQXpNR0JGa0dEWHhUNkRxNE9DemhlS2xoSXd3QmV3TkFFWXZoN0RCY1hmQW5jVitFMExBWTV1bzFyeWN3eU9tNENiQllQWGJmNUE1b3lOTVJ6c09GQTUrNWQvTUxGUUU4bXhtbVkvUHowNEhJOWVTd3R6dVBWNUUyYngvSHhua2RKQU42Uy9HUDNLbldpUERHQmVoSVhKTVVnd0l3WUpLb1pJaHZjTkFRa1VNUlllRkFCd0FISUFhUUIyQUdFQWRBQmxBR3NBWlFCNU1DRUdDU3FHU0liM0RRRUpGVEVVQkJKVWFXMWxJREUwT1RjME5UTTVNVEUwT0RJd2dnM3JCZ2txaGtpRzl3MEJCd2FnZ2czY01JSU4yQUlCQURDQ0RkRUdDU3FHU0liM0RRRUhBVEFvQmdvcWhraUc5dzBCREFFR01Cb0VGRzR2NGdqbm53SU1JZE5aMDh0UWwxRnZqL3VQQWdJRUFJQ0NEWmozS0hVeHRIM1JHTkFVSC9JZGI0VFpJM3d1cFNvdEd1S3BkcitWZkxXK2pMcjJGK2N1a3hrODR5Z25jUUwvUEVhcFRoMjR0blRERjVhblQ3bXRmdDAwcVREbm1Od3lkT0k4NGdGTnRIQ2JrVE1RQWVaaEE4MXVtelJjblQrUkM1NkZtZlJXRU4vNUdHRi9ZbVhhZXIxaXB2dkhTdk5rVGxiZGtEdnJ1U3dHZmttWGo3SUFkL0I1eWxMM1BzUlE5eks3Mm1vVzhTTHRkQnJhaVozN3NKWE5naEFjeVV2Y01pVGRkY1JRWmJqYVVxOVNJSVBVSVM2WW9NRFVlOU5OVkpFa21nbEZZZmJ6aWRDRjNZRG5jbXB0VjhBK2doTVZ3dlo5MXdzU3FnWmhTalA3TDBEZ1R0clFNV1hNNlMvL2VWYVlHTEZOaTN0SExOZ3hjaDh2bld1SUpiREJWUFpwck1yMWVqU3A1elNyYVkxU1Btdk5BVHpXdTdtMUk4TUVmYXpRWlR3VW1iV09GUFZrdGx2RVlCOTVvc2JhRUR6VkFnMFo2eW5tQ29RNVc4Mmp0M3RscGNiUFVZdThQNUhSODJoZ2pJMWhMcU94R29nclpJT2VkUzVqRE5KTUpGNHk2UXBlV2J0bXl2TXIzdlNORjFpaDdQR2VFUGZteTBYdmtURTgvY1lQN0Q0UnVoYzdCK2VIWnFrcmp0NHdRM2tGczEza2FpTWUwQXNjd2MweTI3bURKZlYvbWM5cVJlM3NjbkhVTzlCelZwam83UFlZeDZ1eFcyaDBzRkpaRHZ1Y0JhdHl1RnNJei9IQVhsU2lrQXd4VDBMMi9FbnlzWHVzYVpLOTdqUmhDTVBUWE8xU0dIUFQ5RnNwWEhvUFkzV1FVWVlXclBsZkNMbWVqZHl2c2dld3dGYmtvRjFsWG14OFQ5dDJod1lBYURjTEdoMzZSTWhnY09CT05qYUU4NGpGTUN2TUcvOW9RTTVhbVpnaG5zMG9xNS80R01wRzBIVUROR1pqZW1KWlZHajRDTGpoSXR4WVNFVzFkVGk3MWkyUWFQb0VuOG5aallFeTI3TElBbTlHekdxc0pMcjF5cWpObjJYdlN4NFRTOUMxWkxkUkpvbHUzK2tvSnJtanhOa0dNQWVoTWMvRmgvYlpldTBKNkdyeHp3QStHaEQ5MENwTkl1M1EvSmhwZ1FwSVl2TGRzMVdXSU9pVCt1Zzh6QWhHUnhXcHhVZVE4SVVpQ1NiMjRxU3dwbVRma2hKWGR3UU1WajMxc1ZQU2N2ZnR5SlFqQ0FlVjF2ZzVVNlRjUjJKekVRYkRueHdvOHhYUitmRU9zV3NIWTFiU1I0WlY1RjNkaUFKZWEyK2NBR3hpdVZlNTZaR1RheHk0dE1oQlcxbHJrV3RRc3pJcFJsYmxubE5ENzVvd3oydjdVLy8zRVMxTjZ5aTgwSytZYUMrN3VWNnhoK0ZXc3AwMVpITUZEb0MxY05QcE93bElJUEJud3d5cGprUVJ1UU52SzM4QXoxTmsxbzdENlhkQllpSUEwTlkrRHdReGZJamF2MGxDWnlyeHFpRmdwZ29MYXAwVVNPTkM1Mm5nVHQxcFluT1ZIeGIxMXJuS05lV0Uya1ZtL1BaTjdITCtEMTdiSE0rSFQzU1ExRGZjTSt2SUk3KzBvaTFmYnJMUEltQitkSDg5QkJ0T3k5eFdCK3drNXZrNVNNeFhzdndlMGx0azVHdTVRRlUwbk1KQlhxdGc2ZGlLTDhKb01CN0UvNUdUY3JDMkpsa3pram1QL1ZLcmw4Umwxdm96SUZIVVpwN1R2VXY4a0xma3NxUnlwTDdzSFpaVUYzREhTL2gybzFISmNiMkpJaEQ3d1kxZVlRaE1JaDdKd0tmOVFxMEhzMklmU09waTQvbkdYTjNnVHVINmt4d2N4aXZpWVM3cFJyN01yS0tsK1FBNHpHL1JpcndxSTMvNllpVVRDb3d6WUtsdmFjV1BnNFR1UTBuLytVcUFOSVJoUjFMNWhPb0tDZDRNVlJwaHF6Yi95ZHdFa3o5L2NndkVLVk5IcEEraTdkK0dvMGNpY1FabEJPcVpsRlE0b3pMSkhicFFQMkpHSXp5aytXUDZPb1dxOUNXY3hPUUZNNmNqcnFMWjA0S1FKdTJFMkprQWJlblVUcENDRytsbXBMZzZYQys5M2VJK3ZWMjN3aVZ6UUQvRkRIV1p6TGZLUHJmMzNiMjNrcGFjeXJNVHp6bnZwdEs4eFM2eUE3ZzBxK0k3UFI2emdwbUtYZDNoMWI5WnJTOXVESWhEaFFFMklrQ2luRU9tYW5KVnNmbFN2MmpOK25BMXNydWQ2ay9aU2F2K24rbWp5clowQnE3UHBoTEtUSE1QcWYvclN0MVl5cTBPNjhuN2cxNDBPODNVR3pYc2NGanl2dnk3M3NMMXNmemc2RitGOC82a1YxQ0hoTXVlWkFYK1hFTEFmODdjOGV3KzZ5S1BteVZMVlk2d1RqVUVPUVVuVDl2SkRaVC9TeHJSUWJydWxEV2hRWWdobEJMSVp6aWhkK2VycDkxandaeVFyTXUxVjJNLy80TWpBWGV4anBCdDZlOW1QSTF0WnVjTS8wdm42WFBnOGZJK3lPdUhlMHhPRHE4cWtyVVBGNG4yTitXWDlYU1dDTVlJS2tXdGkvZ3ZxYlhEM3kzWE90U0pJd0tDM2p6N0kyMXQ3MTU5S1hNaGQzdGEvUEVFV3RMYTExcXVoNEVkWnEvMTBPUGdOemxYWGZCUmhlTm1VTnpqaE1zVWZsazlGNE9mU3JEV1VBcGJpczM3K0ZoSlUzdUhkU3Y2UXFYOXVZTXlORW9rV3pZSFFuR1hnbFhRWGtwNlRHZkpiU3daMmVLT0N1RDRsNWFnV0xGTU14K3J2dkw1MytiTkhQNCtaR2ZpVUZoVGlYRnlFUFQ0VVJtcjk4L0MwTlkyTGVZMTdRMzhSMEZYSXJJN3lMSEM5eGFWdUh1alhMZjZ4VG9LcUZFMENuaWd2VWZMcVdGanl5aDRLQjhvdWdZZmVhN1ZaMU1nYmw1WU80L0FKa0ZYQmVHRFhubHNjMVFmN1MzbzJQaHZxZHZJRVEvSjhoK1oyakpVODUrT240US9TeUxyWGhHdEJkQWRVbGFRN3hYWTdkdjhqVS9NUitBN0dYWVlxNU1leVJmR0Y1eUxWUXBja0hva05JdDJ5M0prSHU2WmZ1eGt6Y0tjWGxFdGlHaGVoS1o1anBEaVJKNG93dEx2bXk3OSt6bWtDOVdkUlNmcmQyQ2FHUEtocUxUZ283bTh1SG04YjVTQ0l6OVc0bjluUkZDWEhzYk5uTVNScmZua2sxQStTUnluSkhDbVR2WXNwTEFsWFlmdnVDOUhmbUw5Vmd6SDhxNDlDRHJJOTFlUVdjU1FuRHp0UzJuQ3pwMVdsUkNuRmdLUFlsQVN2VU1ISUY3bENpZjgzaFF3ZHFpK2NLTkVzNWFtWnJWVUMwVnc0T3IzRmpTRmNGTlVneWVsaklJL3BsRTd5eTdnRHZ3VFZaN1BUVk9WYUpDaEh5K0JmT0k2eHRVdzNXUnlHSnJKYmp3OG9oaGNvenF6c09aNVJHcFVteFVGbnZqeTVCODkxS09pN21acGcwS2svcUt6R3ZsVCsydnd4alV6bHZvOGJOS05vcnFFQXZaSGhMNnpUMWpZTmgrcFVVNHdGTDdSNTJYbTZta1psSzAxSEtvSE13S2x6VlZqUVlvd0ZKeUZjWEJFSEVZeDgveitaRHM1UTVVVlM0MysvLzNQNlNXY0w2SGpVZGs4ODFZUU5oZytwVUY4SkVpQ3JDOERZWjEvaXVidUppNnFua21PeFQ0M0taY1lIKzErU3pCMnZCaENrYkpYOXdYbVBOaEVaRGJtdTVjSFB0ZnJTSkNoZnF1OHZMekVqM0VWNnE4d0t0bVJRZ0lPdnhuNlhQS2VmVllUZ0puY0RpS09qRTlkSks5b3prT3JXTkpPYXJ6Y010MTRudm9SZWFCbHJzemRUL1Q0MXp6NnBoQmpzV25YNGpidDVVM0w5M1pEVUtzUFNjcHMzRTM2bEk5UUVHSzdxZloxT2VkNXgxcitLcS9qTWkwYlY3RzJXeXl1N3QyUkwwN3RnTGFZd3RudVhYWm1wNUd0d3RxQmsyZjliZ0lhbjNSK2dxTVZJbkRLRmFQVSttYTRCeUNsQVlLY1VRTjRtQXNoNEM4YmtvWERBOTAyWkpKS0N0K0YxdEFuZUt4a3hoWXozVTlSQ2JUc3phNDlBYkd0L01rREdQemJTdHNNVi85YkdMeVFsVHk4RktYcm1TOUttL2pESno3eVlKdHZCS3EvVElkTk04bmRHM01HVEdDNUcwQ0tBakZHY250VDVlQjV6eE53d3poODRKZzZYK3hHR2l5Sm01eWdRRFVscGxUY1VRdXhwM1kvSTdheEp3ckxqeTJkT2lpTFBSN3g3amRSR1hXNTREQzZsd0kvbEVZN1dmNnFBaDRvVjVMSzFmSkdJTm9DcjV5c1NOVDVDOEdkbGQ2M3d4cmM5SGU4aklCWDRIUzE3aUE2cXhmR1pjOFdDTENFM29DRnltVGh5M1h5UEZ6aW1vb05SaTRjcWxVWllEZEd1N3BkSUg3MGFiUmYvUzk3QXNWZitRa1VoVkdzRGZxYUpSZkxmRWR4K2szandWVDBBVEVUQmJ4RG01WXpCTjVZeEJ3aGhXQWlBV3E3K1g3aEZZWlAzVHFEanVDeEdMVCt1UFZlMjRMU1VyYmM3L1VoZytRSy9qd0VoeUtuTWVGb1FhZGFJQWZ4Z2N2akVVYXZDY3NKNldiaWNqaGNqZlFlQzZ6S2k4OUxuaGxscS91b0tCR0tZYU54T1UyQ2I3Njd4dG0zVndKQWJEaC80cjhpbDZYeFY1NW1JTHh0KzFGNE9MUzR6cGRtZlMvV3h0cWcyTHg1RDIzdlV0OEpiZDlxUGJ1MXFDMk5oM1F4QnYxN2pHVFZSdi9tRE90SlMzc0YxZzE2bTRNcVhzVzdwRklvVmRpRDBUd3NBRVV2eUVzK2Q0TVNKd1hkZm1QNkZCT29XWCs2emlEbGZmSTd6RFFqS2wycE4zZlBVdjVHSFc4aUZ0VkNya0tNV1dUTk5HbnFmUXRRenAvWXgybHlEQmI3alBvTkZJZ0dPOG9ROTN3TmxCWXVuV0VkempEWHJGRmJHekpsSytxWHVFcnBtR1BySlFUNFNHU3VYbmx1ZStHYmpPdTdDSWM1UmErT1hja1RKeDd2N1l6cWZlU1hmVmVES0V4b1gxYWtaNlhxMVliTm9YcWQ0Q0lGZitUMXlCL21uTzNpUlZBWkdEeFZrOG5nd0orbWRxcy9jZGw0R0NQT0ZXMDVUeGJNZ2U1TTRCZFltUURMeXQxTGU2SE9MQVpGdGdBam9vcnZxY1F2MEtuNk9Nbk5ndHVuRkJnMDFVeXZ0dHh1S0UyNTU4eEZZcU9HTVFoZzFWaWc0RFJNTFVieDZhd0EvOEtHd2lRK2UxeWN1V3dyMjFDTHdLZ1F2REw5cURYNzVPb1NLbjBTSkl4c2VWUzBsMlg5YUd5RG5zR0lwNUhlcS9MTDkxK004enVBaE04eUJicUp0ZGJ3d2Z3VUsvRkJMcmNJTmo3VzU4UDhzRlo4cXhUYWVoVWpFWVlQUDlrUE4vakpuRUhZb1k3M2F6eUdRdnM2Nmc0UWFKaFdXL21GbzNGcnN5WERlTFUrS0wyVXNTS2xnZHZiTTRQVFF0cXF1bmR3dVRnNFRscVRHai9QSTYxZGVFM3FtVlc4SXd0czcwNVhlL1hJZzVqRzVEWnJ2enJlUEQweENGanhwRll0UWptZ1EwUHlmR3pqMUUvT0QyL3hvd1M2RnlNZS9zelJGczBDaXJaWmlsbXovdEFGUTBTNzdCaU9zcEZhZUpCWXNrelk4M0lIa2ZwbWtrdURIUjhUam5EVkw0aUVzZFRpTXpZWXhQTkRBVnp2eUxvQlE1V0pPM29sL0tmQ2E0Tm5icjdRZVJyQlNUSHVTS2Z6QzBsNk5LeVNPL2RCWDRCNTVrdXVPTFk2alFHTldKdnlzYzZzb2lCSDZWWGY1OGoxeHI3QldKNXZoQWFrY01nRE9Bc0FFUkoxNk9mV1ZzN0lLeUhhUzl5dTg1SWtQWHRBZlVoVUEyRXdQVEFoTUFrR0JTc09Bd0lhQlFBRUZCd05HZWVjQUZuYkZ2K1VncURVUVRSRStldWZCQlNYemlxWFNGMmRFajVMTW9vckhqa003MHFEUWdJQ0JBQT0ifQ==";

	String authenticationTokenSignerKeystorePasswordEncrypted = "EsXpdgRtOGkxYAGBUU/GTFbQ6HoW1ySXKphO8zSe3O/Nw03ImQpFdcvVbEgVEyu/AwzwamaOuUNc87y6u7L8OBZ1k6u8+c9OUoQVczYprsHc9kvhdR1ASpDPofsD2taRdR04rQsgthSvja7efBDXrxHfVsocLoZKtXJe5Mmqylv7dUUPeEQOG3ENXAOKV8SFl2WQ00pyrjextjesmBmuscfvtaW6SXtrPGu0zv9vKqhJSOEN0ORFdqwWOXbvyIJtStvexFUnY8ZM2p/u7RnsKG2DgGAkHuWSltYyH/q8rC5rC6M/hOb2LUKshlnosf7Mp+koYKw4qFmB1DXdmw/9y9Utx+9sEy2enz5ALWKyP8U4JKO7PvimIiqTUgEXlqVwDNh9t6Wrv3kOXk6KIIhwgw64EIK5IQ==";

	String systemTenantAuthenticationKeystore = "/keystore/100_AU.sks";

	String systemTenantAuthenticationKeystorePassword = "RBW6WD4IPTA73VT4KASLILIIFJ";

	@BeforeClass
	public static void setUp() {
		AsymmetricService asymmetricService = new AsymmetricService();

		extendedKeyStoreService = new ExtendedKeyStoreService();

		passwordEncrypter = new PasswordEncrypter(asymmetricService);
	}

	@Test
	public void ballotBoxSignerIT() throws GeneralCryptoLibException {

		CryptoAPIExtendedKeyStore store = loadElectionEventKeystore(systemTenantElectionInformationKeystore,
				systemTenantElectionInformationKeystorePassword, ballotBoxSignerKeystorePasswordEncrypted, ballotBoxSignerKeystore);

		List<String> aliases = store.getPrivateKeyAliases();
		assertEquals(1, aliases.size());
		assertEquals("privatekey", aliases.get(0));
	}

	@Test
	public void authTokenSignerIT() throws GeneralCryptoLibException {

		CryptoAPIExtendedKeyStore store = loadElectionEventKeystore(systemTenantAuthenticationKeystore, systemTenantAuthenticationKeystorePassword,
				authenticationTokenSignerKeystorePasswordEncrypted, authenticationTokenSignerKeystore);

		List<String> aliases = store.getPrivateKeyAliases();
		assertEquals(1, aliases.size());
		assertEquals("privatekey", aliases.get(0));
	}

	private CryptoAPIExtendedKeyStore loadElectionEventKeystore(final String pathSystemTanantKeystore, final String systemTanantKeystorePassword,
			final String keystorePasswordEncrypted, final String keystore) throws GeneralCryptoLibException {

		CryptoAPIExtendedKeyStore tenantKeystore = new ExtendedKeyStoreService()
				.loadKeyStore(readKeystoreAsStream(pathSystemTanantKeystore), systemTanantKeystorePassword.toCharArray());

		char[] passwordAsCharArray = systemTanantKeystorePassword.toCharArray();
		String ALIAS = "encryptionkey";
		PrivateKey systemTenantPrivatekey = tenantKeystore.getPrivateKeyEntry(ALIAS, passwordAsCharArray);

		String keystorePasswordPlaintext = passwordEncrypter.decryptPassword(keystorePasswordEncrypted, systemTenantPrivatekey);

		byte[] keystoreAsBytes = Base64.getDecoder().decode(keystore.getBytes(StandardCharsets.UTF_8));

		InputStream inputStream = new ByteArrayInputStream(keystoreAsBytes);
		passwordAsCharArray = keystorePasswordPlaintext.toCharArray();
		PasswordProtection passwordProtection = new PasswordProtection(passwordAsCharArray);

		return extendedKeyStoreService.loadKeyStoreFromJSON(inputStream, passwordProtection);
	}

	private InputStream readKeystoreAsStream(final String path) {

		return getClass().getResourceAsStream(path);
	}
}
